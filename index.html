<!DOCTYPE html>
<html lang="uk">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Mira Kids ‚Äî –Ü–≥—Ä–∞—à–∫–∏</title>

<style>
body {
  margin: 0;
  font-family: Arial, sans-serif;
  background: #fff7fb;
}

header {
  background: linear-gradient(90deg,#ff7eb3,#ffb86c);
  padding: 20px;
  text-align: center;
  color: #fff;
}

.filters {
  display: flex;
  gap: 8px;
  flex-wrap: wrap;
  justify-content: center;
  margin: 20px;
}

.filter-btn {
  padding: 8px 14px;
  border-radius: 20px;
  border: none;
  background: #ffd1e6;
  cursor: pointer;
  font-weight: bold;
}

.filter-btn.active {
  background: #ff5fa2;
  color: #fff;
}

.products {
  display: grid;
  grid-template-columns: repeat(auto-fit,minmax(200px,1fr));
  gap: 20px;
  padding: 20px;
}

.card {
  background: #fff;
  border-radius: 20px;
  padding: 15px;
  text-align: center;
  box-shadow: 0 8px 20px rgba(0,0,0,0.1);
}

.card img {
  width: 100%;
  border-radius: 14px;
}

.price {
  font-weight: bold;
  color: #ff5fa2;
}

.badge {
  background: #ff5fa2;
  color: #fff;
  display: inline-block;
  padding: 4px 10px;
  border-radius: 12px;
  font-size: 12px;
}

#pagination {
  text-align: center;
  margin: 20px;
}

#pagination button {
  margin: 0 4px;
  padding: 6px 12px;
  border-radius: 12px;
  border: none;
  cursor: pointer;
}

#resultsInfo {
  text-align: center;
  color: #555;
  margin-top: 10px;
}
</style>
</head>

<body>

<header>
  <h1>Mira Kids üß∏</h1>
</header>

<div class="filters" id="filters"></div>
<div id="resultsInfo"></div>
<div class="products" id="products"></div>
<div id="pagination"></div>

<script>
// =====================
// –ù–ê–°–¢–†–û–ô–ö–ò
// =====================
const ITEMS_PER_PAGE = 12;
let currentPage = 1;
let currentCategory = 'all';
let allProducts = [];

// ‚ö†Ô∏è CORS-PROXY –¥–ª—è GitHub Pages
const FEED_URL =
  'https://api.allorigins.win/raw?url=' +
  encodeURIComponent(
    'https://toysi.ua/feed-products-residue.php?key=3a1f85868344f5755c1441bfa7846444&vendor_code=prom&lang=ukr'
  );

// =====================
// –ó–ê–í–ê–ù–¢–ê–ñ–ï–ù–ù–Ø XML
// =====================
fetch(FEED_URL)
  .then(r => r.text())
  .then(xmlText => {
    const xml = new DOMParser().parseFromString(xmlText, 'text/xml');

    const categoryMap = {};
    xml.querySelectorAll('category').forEach(c => {
      categoryMap[c.getAttribute('id')] = c.textContent.trim();
    });

    xml.querySelectorAll('offer').forEach((offer, i) => {
      const name = offer.querySelector('name')?.textContent || '';
      const price = offer.querySelector('price')?.textContent || '0';
      const image = offer.querySelector('picture')?.textContent || '';
      const catId = offer.querySelector('categoryId')?.textContent || '';
      const category = categoryMap[catId] || '–Ü–Ω—à–µ';

      allProducts.push({
        name,
        price,
        image,
        category
      });
    });

    renderFilters();
    render();
  })
  .catch(() => {
    document.getElementById('products').innerHTML =
      '<p style="color:red;text-align:center;">–ù–µ –≤–¥–∞–ª–æ—Å—è –∑–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ —Ç–æ–≤–∞—Ä–∏</p>';
  });

// =====================
// –§–Ü–õ–¨–¢–†–ò
// =====================
function renderFilters() {
  const filters = document.getElementById('filters');
  const categories = [...new Set(allProducts.map(p => p.category))];

  filters.innerHTML = `<button class="filter-btn active" data-cat="all">–£—Å—ñ</button>`;

  categories.forEach(cat => {
    filters.innerHTML += `<button class="filter-btn" data-cat="${cat}">${cat}</button>`;
  });

  document.querySelectorAll('.filter-btn').forEach(btn => {
    btn.onclick = () => {
      document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
      btn.classList.add('active');
      currentCategory = btn.dataset.cat;
      currentPage = 1;
      render();
    };
  });
}

// =====================
// –†–ï–ù–î–ï–†
// =====================
function render() {
  const filtered =
    currentCategory === 'all'
      ? allProducts
      : allProducts.filter(p => p.category === currentCategory);

  const start = (currentPage - 1) * ITEMS_PER_PAGE;
  const end = start + ITEMS_PER_PAGE;
  const pageItems = filtered.slice(start, end);

  const products = document.getElementById('products');
  products.innerHTML = '';

  pageItems.forEach(p => {
    products.innerHTML += `
      <div class="card">
        <span class="badge">–•–Ü–¢</span>
        <img src="${p.image}">
        <h3>${p.name}</h3>
        <div class="price">${p.price} –≥—Ä–Ω</div>
        <a href="https://t.me/mira_sam_s_v" target="_blank">–ó–∞–º–æ–≤–∏—Ç–∏</a>
      </div>
    `;
  });

  renderPagination(filtered.length);
  renderInfo(filtered.length);
}

// =====================
// –ü–ê–ì–Ü–ù–ê–¶–Ü–Ø
// =====================
function renderPagination(total) {
  const pages = Math.ceil(total / ITEMS_PER_PAGE);
  const pag = document.getElementById('pagination');
  pag.innerHTML = '';

  for (let i = 1; i <= pages; i++) {
    const btn = document.createElement('button');
    btn.textContent = i;
    btn.style.background = i === currentPage ? '#ff5fa2' : '#ffd1e6';
    btn.style.color = i === currentPage ? '#fff' : '#000';
    btn.onclick = () => {
      currentPage = i;
      render();
      window.scrollTo({ top: 0, behavior: 'smooth' });
    };
    pag.appendChild(btn);
  }
}

// =====================
// –Ü–ù–§–û ‚Äú–ü–æ–∫–∞–∑–∞–Ω–æ 1‚Äì12 –∑ ‚Ä¶‚Äù
// =====================
function renderInfo(total) {
  const info = document.getElementById('resultsInfo');
  if (!total) {
    info.textContent = '–¢–æ–≤–∞—Ä—ñ–≤ –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ';
    return;
  }
  const start = (currentPage - 1) * ITEMS_PER_PAGE + 1;
  const end = Math.min(start + ITEMS_PER_PAGE - 1, total);
  info.textContent = `–ü–æ–∫–∞–∑–∞–Ω–æ ${start}‚Äì${end} –∑ ${total}`;
}
</script>

</body>
</html>
